<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lab 2 | IMU</title>

  <!-- Keep it minimal & Lab1-like (markdown-style page) -->
  <style>
    :root{
      --text:#24292f;
      --muted:#57606a;
      --border:#d0d7de;
      --bg:#ffffff;
      --codebg:#f6f8fa;
      --link:#0969da;
    }
    html,body{background:var(--bg); color:var(--text); margin:0; padding:0; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji"; line-height:1.6;}
    .wrap{max-width: 920px; margin: 0 auto; padding: 28px 20px 60px;}
    a{color:var(--link); text-decoration:none;}
    a:hover{text-decoration:underline;}
    h1{font-size: 2rem; margin: 10px 0 8px;}
    h2{font-size: 1.5rem; margin: 26px 0 10px; padding-top: 6px; border-top: 1px solid var(--border);}
    h3{font-size: 1.15rem; margin: 18px 0 8px;}
    p{margin: 8px 0;}
    .meta{color:var(--muted); margin: 2px 0;}
    .toc-title{margin-top: 18px; font-weight:600;}
    ol{margin: 8px 0 12px 22px;}
    ul{margin: 6px 0 10px 22px;}
    code{background:var(--codebg); padding: 2px 6px; border-radius: 6px; font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace; font-size: 0.95em;}
    pre{background:var(--codebg); padding: 12px 14px; border-radius: 10px; overflow:auto; border:1px solid var(--border);}
    pre code{background:transparent; padding:0;}
    .figure{
      border:1px dashed var(--border);
      border-radius: 12px;
      padding: 14px;
      margin: 10px 0;
      color: var(--muted);
      background: #fff;
    }
    .figure strong{color: var(--text);}
    .note{
      border-left: 4px solid var(--border);
      padding: 10px 12px;
      background: #fff;
      color: var(--muted);
      margin: 12px 0;
      border-radius: 8px;
    }
    .back{display:inline-block; margin-bottom: 10px;}
    hr{border:none; border-top:1px solid var(--border); margin: 18px 0;}
  </style>
</head>

<body>
  <div class="wrap">

    <a class="back" href="../index.html">← Back to Home</a>

    <h1>Lab 2: IMU</h1>
    <p class="meta">Course: ECE 5160 Fast Robots (Spring 2026)</p>
    <p class="meta">Student: Hetao Yin</p>

    <p class="toc-title">Table of Contents</p>
    <ol>
      <li><a href="#overview">Overview</a></li>
    
      <li><a href="#lab-tasks">Lab Tasks</a></li>
      <li><a href="#discussion">Discussion</a></li>
      <li><a href="#optional">5000-level (Optional)</a></li>
      <li><a href="#references">References</a></li>
    </ol>

 

    <!-- 1. Overview -->
    <h2 id="overview">1. Overview</h2>
    <p>
      In this lab, an inertial measurement unit (IMU) was integrated with the Artemis board to measure linear acceleration and angular velocity. The SparkFun ICM-20948 IMU was configured and used to collect accelerometer and gyroscope data for estimating the robot’s orientation.


      
      Accelerometer and gyroscope measurements were analyzed in both time and frequency domains, and filtering techniques were applied to reduce noise and drift. A complementary filter was implemented to fuse both sensors, and IMU data were logged and transmitted over Bluetooth to record and analyze the motion of the robot during a driving experiment.
    </p>

    <h3>Hardware / Software</h3>
    <ul>
      <li>Board: SparkFun RedBoard Artemis Nano</li>
      <li>IMU: SparkFun 9DOF ICM-20948 breakout (QWIIC)</li>
      <li>IDE: Arduino IDE</li>
      <li>Python: venv + JupyterLab (for plotting / FFT / data parsing)</li>
      <li>Robot platform: Force1 RC car + Li-Ion battery</li>
    </ul>



    <!-- 3. Lab Tasks -->
    <h2 id="lab-tasks">3. Lab Tasks</h2>
    <p>
      Below follows the Lab 2 write-up sections. For each section: explain what you implemented/changed, show evidence (images/plots/videos),
      and include minimal code snippets (not full code).
    </p>

     <!-- 3.1 Set up the IMU -->
    <h3 id="accelerometer">3.1 Set up the IMU</h3>

<ul>
  <li>
    <b>AD0_VAL:</b>
    <code>AD0_VAL</code> sets the least significant bit of the IMU’s I<sup>2</sup>C address.
    In the provided <code>Example1_Basics</code> code, <code>AD0_VAL</code> is set to
    <code>1</code>, which matches the hardware configuration of the SparkFun ICM-20948
    breakout used in this lab and allows successful I<sup>2</sup>C communication.
  </li>

  <li>
    <b>Sensor behavior:</b>
    When the board is rotated or flipped, the accelerometer readings change according to the
    direction of gravity, while the gyroscope reports angular velocity during rotation.
    During linear acceleration, the accelerometer shows transient changes, whereas the
    gyroscope remains near zero unless rotational motion is present.
  </li>
</ul>

<div class="figure">
  <strong>Figure 1.</strong> Serial output from <code>Example1_Basics</code> while rotating, flipping,
  and accelerating the IMU board.
  <br><br>

  <img src="images/3.1.png"
       alt="Example1_Basics serial output"
       style="max-width:100%; height:auto; border-radius:8px;">
</div>


    <!-- 3.2 Accelerometer -->
    <h3 id="accelerometer">3.2 Accelerometer</h3>
    <ul>
    <li>
  <b>Pitch/Roll equations:</b>
  <br><br>

  <!-- Video -->
  <div>
    <div style="font-weight:600; margin-bottom:6px;">
      Real-time pitch and roll display
    </div>
    <video src="videos/3.2.mp4"
           controls
           style="max-width:100%; border-radius:8px;">
    </video>
  </div>

  <br>

  <!-- Image (code screenshot) -->
  <div>
    <div style="font-weight:600; margin-bottom:6px;">
      Pitch and roll computation code
    </div>
    <img src="images/3.2_1.png"
         alt="Pitch and roll computation code screenshot"
         style="max-width:100%; height:auto; border-radius:8px;">
  </div>
</li>

      <li><b>Noise analysis:</b> [TODO: record data, FFT, discuss spectrum + choose cutoff frequency]</li>
      <li><b>Low-pass filter:</b> [TODO: implement LPF and show raw vs filtered plot]</li>
      <li><b>Jupyter plotting:</b> [TODO: time on x-axis, signal on y-axis]</li>
    </ul>

   <li>
  <b>Noise analysis and cutoff frequency:</b>
  <br><br>

  The accelerometer signal shows significant low-frequency content, with most energy
  concentrated below approximately 4–5 Hz, while higher frequencies are dominated by noise.
  <br><br>

  Based on the FFT, a low-pass filter cutoff of about 4 Hz was selected. This cutoff retains
  motion-related information while suppressing high-frequency vibrational noise. Lower
  cutoffs oversmooth the signal, whereas higher cutoffs allow excessive noise to pass.
  <br><br>

  <div class="figure">
    <strong>Figure 3.</strong> Fourier Transform of accelerometer data.
    <br><br>
    <img src="images/3.2_2.png"
         alt="FFT of accelerometer data"
         style="max-width:100%; height:auto; border-radius:8px;">
  </div>
</li>
<li>
  <b>Low-pass filtering:</b>
  <br><br>

  A simple low-pass filter was applied to the accelerometer data to reduce high-frequency
  noise. Compared to the raw signal, the filtered signal is significantly smoother while
  preserving the overall motion trend.
  <br><br>

  <div class="figure">
    <strong>Figure 4.</strong> Accelerometer signal before and after low-pass filtering.
    <br><br>
    <img src="images/3.2_3.png"
         alt="Accelerometer signal before and after low-pass filtering"
         style="max-width:100%; height:auto; border-radius:8px;">
  </div>
</li>


    <!-- 3.3 Gyroscope -->
    <h3 id="gyroscope">3.3 Gyroscope</h3>
    <ul>
      <li>
  <b>Angle integration:</b>
  <br><br>

  <!-- Video -->
  <div>
    <div style="font-weight:600; margin-bottom:6px;">
      Real-time roll/pitch from gyroscope integration
    </div>
    <video src="videos/3.3.mp4"
           controls
           style="max-width:100%; border-radius:8px;">
    </video>
  </div>

  <br>

  <!-- Image (code screenshot) -->
  <div>
    <div style="font-weight:600; margin-bottom:6px;">
      Gyroscope angle integration code
    </div>
    <img src="images/3.3_1.png"
         alt="Gyroscope angle integration code screenshot"
         style="max-width:100%; height:auto; border-radius:8px;">
  </div>
</li>

     <li>
  <b>Comparison:</b>
  Gyroscope-based angles are smooth in the short term and respond well to rapid motion,
  but they gradually drift over time due to integration error. Accelerometer-based angles
  do not drift and provide a stable long-term reference, but are noisy and sensitive to
  vibration. After low-pass filtering, the accelerometer signal becomes smoother, but still
  lags during fast motion. Overall, the gyroscope captures high-frequency motion accurately,
  while the (filtered) accelerometer provides reliable low-frequency orientation.
</li>
      <li>
  <b>Sampling frequency effects:</b>
  Sampling rates of approximately low, medium, and high (tens of Hz up to ~100 Hz) were tested.
  At lower sampling rates, gyroscope integration exhibits noticeable drift and reduced accuracy
  due to larger integration steps. Increasing the sampling rate improves short-term accuracy
  and responsiveness, but the difference becomes marginal beyond moderate rates, while noise
  accumulation and processing overhead increase. Overall, moderate-to-high sampling rates
  provide the best trade-off between accuracy and stability.
</li>
     <li>
  <b>Complementary filter:</b>
  <br><br>

  <!-- Video -->
  <div>
    <div style="font-weight:600; margin-bottom:6px;">
      Real-time pitch and roll using complementary filter
    </div>
    <video src="videos/3.3_2.mp4"
           controls
           style="max-width:100%; border-radius:8px;">
    </video>
  </div>

  <br>

  <!-- Image (code screenshot) -->
  <div>
    <div style="font-weight:600; margin-bottom:6px;">
      Complementary filter implementation
    </div>
    <img src="images/3.3_2.png"
         alt="Complementary filter code screenshot"
         style="max-width:100%; height:auto; border-radius:8px;">
  </div>
</li>

  
   
    <pre><code>// TODO: minimal Arduino snippet for gyro integration + complementary filter
</code></pre>

   <section class="page-section" id="sample-data">
  <div class="container">

    <h2 class="page-section-heading text-center text-uppercase text-secondary mb-4">
      Sample Data
    </h2>

    <!-- =======================
         Part 1: Evidence
    ======================== -->
    <h3>Part 1: Data Collection Evidence</h3>

    <p>
      The following video demonstrates the board collecting IMU data for several seconds
      and successfully transmitting the data to the computer.
    </p>

    <video controls width="100%" style="max-width: 800px;">
      <source src="videos/3.4.mp4" type="video/mp4">
      Your browser does not support the video tag.
    </video>

    <p class="mt-4">
      The screenshot below shows the optimized <code>loop()</code> function used for
      non-blocking IMU sampling and data storage.
    </p>

    <img
      src="images/3.4.png"
      class="img-fluid"
      alt="Optimized loop code"
      style="max-width: 800px;"
    />

    <!-- =======================
         Part 2: Questions
    ======================== -->
    <h3 class="mt-5">Part 2: Questions and Answers</h3>

    <h5>1. Speed up execution of the main loop</h5>
    <ul>
      <li>
        The main loop was made non-blocking by continuously checking
        <code>myICM.dataReady()</code> instead of waiting for new IMU data.
      </li>
      <li>
        All debug delays and continuous <code>Serial.print</code> statements were removed.
      </li>
      <li>
        The effective sampling rate was measured by counting the number of samples collected
        per second.
      </li>
      <li>
        The main loop runs significantly faster than the IMU produces new data; most loop
        iterations simply check the data-ready flag.
      </li>
    </ul>

    <h5>2. Store time-stamped IMU data in arrays</h5>
    <p>
      Time-stamped IMU data was collected in the main loop and stored in arrays when a
      recording flag was enabled. The flag was controlled using serial commands to start
      and stop data recording. After recording stopped, the buffered data was transmitted
      to the computer.
    </p>

    <h5>3. Data storage considerations</h5>
    <ul>
      <li>
        Separate arrays were used for accelerometer, gyroscope, and attitude data to keep
        data organization simple and transmission straightforward.
      </li>
      <li>
        Sensor data was stored as <code>float</code> values to provide sufficient precision
        while minimizing memory usage. Timestamps were stored as
        <code>unsigned long</code>.
      </li>
      <li>
        Each sample requires approximately 36 bytes of memory. Given the available RAM on
        the Artemis board, several thousand samples can be stored, corresponding to
        tens of seconds of IMU data depending on the sampling rate.
      </li>
    </ul>

    <h5>4. Capture at least 5 seconds of IMU data and transmit over Bluetooth</h5>
    <p>
      The system was able to capture more than 5 seconds of IMU data by buffering samples
      in memory and transmitting them to the computer after recording stopped. The duration
      was verified using the first and last timestamps in the received data.
    </p>

  </div>
</section>

    <!-- 3.5 Record a stunt -->
    <h3 id="stunt">3.5 Record a stunt!</h3>
    <ul>
      <li><b>Battery mounting:</b> [TODO: note correct polarity red-red / black-black]</li>
      <li><b>Baseline driving:</b> [TODO: 5 min manual driving observations (speed/turning/accel)]</li>
      <li><b>Video evidence:</b> [TODO: embed video(s) or link(s)]</li>
      <li><b>Discussion:</b> [TODO: what you expected to see in IMU during stunt]</li>
    </ul>

    <div class="figure">
      <strong>Video X.</strong> Manual driving / stunt recording.<br/>
      [TODO: &lt;video controls src="videos/lab2/your_video.mp4"&gt;&lt;/video&gt; or a hosted link]
    </div>

    <!-- 3.6 Pack up (optional section, but keeps flow complete) -->
    <h3 id="pack-up">3.6 Pack up</h3>
    <ul>
      <li>[TODO: batteries disconnected, shared batteries returned to chargers, AA returned to TAs]</li>
    </ul>

    <!-- 4. Discussion -->
    <h2 id="discussion">4. Discussion</h2>
    <ul>
      <li><b>Key takeaways:</b> [TODO]</li>
      <li><b>Biggest issues & fixes:</b> [TODO]</li>
      <li><b>Filter design choices:</b> [TODO: cutoff frequency reasoning + complementary filter parameter]</li>
      <li><b>What you would improve next:</b> [TODO]</li>
    </ul>

    <!-- 5. 5000-level (Optional) -->
    <h2 id="optional">5. 5000-level (Optional)</h2>
    <p>
      [TODO: If required. Otherwise: "No additional tasks for 5000-level students in this lab."]
    </p>

    <!-- 6. References -->
    <h2 id="references">6. References</h2>
    <ol>
      <li>[TODO: SparkFun ICM-20948 library / datasheet / course handout link]</li>
      <li>[TODO: Any FFT tutorial used]</li>
      <li>[TODO: Any additional sources]</li>
    </ol>

    <hr/>
    <p class="meta">
      Hosted on GitHub Pages.
    </p>

  </div>
</body>
</html>

